(this["webpackJsonpreact-minesweeper"]=this["webpackJsonpreact-minesweeper"]||[]).push([[0],{115:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var r=n(36),a=n(20);function c(e,t){for(var n=e.x,r=e.y,a=[],c=-1;c<=1;c++)for(var o=-1;o<=1;o++){var s=n+c,i=r+o;t[s]&&t[s][i]&&a.push(t[s][i])}return a}a.a.createModule("board",{initialState:{cells:[]}});var o=a.a.createLocalEvent("board","INIT_BOARD",(function(e,t){for(var n=t.cols,a=t.rows,o=t.bombs,s=0;s<n;s++){e.cells.push([]);for(var i=0;i<a;i++)e.cells[s].push({is_revealed:!1,is_bomb:!1,is_flagged:!1,value:0,x:s,y:i})}for(var u=[],l=0;l<n;l++)for(var d=0;d<a;d++)u.push([l,d]);function f(e){var t=Math.floor(Math.random()*e.length),n=e[t];return e.splice(t,1),n}for(var v=0;v<o;v++){if(!u.length)return;var h=f(u),p=Object(r.a)(h,2),b=p[0],g=p[1];e.cells[b][g].is_bomb=!0,c(e.cells[b][g],e.cells).forEach((function(e){return e.is_bomb?null:e.value+=1}))}})),s=a.a.createLocalEvent("board","TRIGGER_REVEAL",(function(e,t){var n=t.x,r=t.y;if(e.cells[n]&&e.cells[n][r]){var a=e.cells[n][r];a.is_revealed||function e(t,n){t.is_revealed||t.is_flagged||(t.is_revealed=!0,t.is_bomb&&function(e){e.cells.forEach((function(e){e.forEach((function(e){e.is_revealed=!0}))}))}(n),t.value||c(t,n.cells).map((function(t){return e(t,n)})))}(a,e)}}))},137:function(e,t,n){e.exports=n(226)},20:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=new(n(35).StateManager)},226:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(14),o=n.n(c),s=n(26),i=n(52),u=(n(146),n(232)),l=n(9),d=n(13),f=n(78),v=n.n(f),h=Object(d.a)();h.location=Object(l.a)(Object(l.a)({},h.location),{},{query:v.a.parse(h.location.search.substr(1)),state:{}}),h.listen((function(){h.location=Object(l.a)(Object(l.a)({},h.location),{},{query:v.a.parse(h.location.search.substr(1)),state:h.location.state||{}})}));h.go,h.goBack,h.push,h.replace;var p=h,b=n(231),g=n(233),k=n(234),O=n(230),m=n(41),E=function(){var e=Object(s.b)(),t=Object(s.c)(m.boardSelectors.board);return a.a.createElement(b.a,null,t.cells.map((function(t,n){return a.a.createElement(g.a,{key:n},t.map((function(t,r){return a.a.createElement(k.a,{key:r},a.a.createElement(O.a,{type:t.is_revealed?"primary":void 0,style:{width:30,height:30},onClick:function(){return e(Object(m.triggerReveal)({x:n,y:r}))}},t.value))})))})))},j=function(){var e=Object(s.b)();return Object(r.useEffect)((function(){e(Object(m.initBoard)({rows:3,cols:3,bombs:1}))}),[e]),a.a.createElement("div",null,a.a.createElement(E,null))},y=function(){return a.a.createElement(u.a,{history:p},a.a.createElement(i.a,{defer:!1,htmlAttributes:{lang:"en"},encodeSpecialCharacters:!0,defaultTitle:"Minesweeper",titleTemplate:"%s | PM",titleAttributes:{itemprop:"name",lang:"en"}}),a.a.createElement(j,null))};y.defaultProps={};var S=y;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var C=n(8),w=n(134),_=n(135),T=n(20),M=n(35),x=Object(_.a)(),R=Object(C.compose)(Object(C.applyMiddleware)(Object(M.createSocketMiddleware)(T.a)),Object(C.applyMiddleware)(x),Object(w.devToolsEnhancer)({})),N=Object(C.createStore)(T.a.reducer,R);x.run(T.a.saga),o.a.render(a.a.createElement(s.a,{store:N},a.a.createElement(i.b,null,a.a.createElement(S,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},35:function(e,t,n){"use strict";n(90);var r=n(91);n.o(r,"StateManager")&&n.d(t,"StateManager",(function(){return r.StateManager})),n.o(r,"apiCaller")&&n.d(t,"apiCaller",(function(){return r.apiCaller})),n.o(r,"createSocketMiddleware")&&n.d(t,"createSocketMiddleware",(function(){return r.createSocketMiddleware}))},41:function(e,t,n){"use strict";var r=n(88);n.o(r,"boardSelectors")&&n.d(t,"boardSelectors",(function(){return r.boardSelectors})),n.o(r,"initBoard")&&n.d(t,"initBoard",(function(){return r.initBoard})),n.o(r,"triggerReveal")&&n.d(t,"triggerReveal",(function(){return r.triggerReveal}))},53:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var r="",a="";r="http://".concat("","/api"),a="ws://".concat("","/api")},6:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return o})),n.d(t,"j",(function(){return s})),n.d(t,"e",(function(){return i})),n.d(t,"n",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"k",(function(){return d})),n.d(t,"m",(function(){return f})),n.d(t,"l",(function(){return v})),n.d(t,"g",(function(){return h})),n.d(t,"h",(function(){return p})),n.d(t,"i",(function(){return b}));var r=1e4,a=5e3,c="PING",o="PONG",s="SOCKET_OPENED",i="SOCKET_CLOSED",u={0:"SOCKET_CONNECTING",1:s,2:"SOCKET_CLOSING",3:i},l="SOCKET_COMMAND",d="SOCKET_RECEIVE",f="SOCKET_RECONNECTED",v="SOCKET_RECONNECT",h="SOCKET_CONNECT",p="SOCKET_CONNECTED",b="SOCKET_DISCONNECT"},88:function(e,t,n){"use strict";var r=n(89);n.d(t,"boardSelectors",(function(){return r}));var a=n(115);n.d(t,"initBoard",(function(){return a.a})),n.d(t,"triggerReveal",(function(){return a.b}));n(98)},89:function(e,t,n){"use strict";n.r(t),n.d(t,"board",(function(){return r}));var r=function(e){return e.board}},90:function(e,t,n){"use strict";n(0)},91:function(e,t,n){"use strict";var r=n(92);n.d(t,"apiCaller",(function(){return r.a}));var a=n(94);n.d(t,"StateManager",(function(){return a.a}));n(95);var c=n(96);n.d(t,"createSocketMiddleware",(function(){return c.a}));n(97)},92:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(21),a=n.n(r),c=n(9),o=n(119),s=n(120),i=n.n(s),u=n(53);function l(e){return d.apply(this,arguments)}function d(){return(d=Object(o.a)(a.a.mark((function e(t){var n,r,o,s,l,d,f,v,h,p,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.path,r=t.method,o=void 0===r?"GET":r,s=t.data,l=t.token,d=t.session_id,f=t.endpoint,d&&(s=Object(c.a)(Object(c.a)({},s),{},{session_id:d})),v="?"+i.a.stringify(s||{}),(h="".concat(u.a,"/").concat(f).concat(n)).endsWith("/")||(h+="/"),"GET"===o&&(h+=v),n.split("/").filter((function(e){return":"===e[0]})).forEach((function(e){var t=e.slice(1);h=h.replace(e,s[t]),s[t]=void 0})),(p=new Headers).append("Content-Type","application/json"),l&&p.append("Authorization","JWT ".concat(l)),e.next=13,fetch(h,{headers:p,method:o,body:"GET"!==o?JSON.stringify(s):void 0});case 13:return b=e.sent,e.prev=14,e.next=17,b.json();case 17:return e.t0=e.sent,e.t1=b.status,e.abrupt("return",{result:e.t0,status:e.t1});case 22:return e.prev=22,e.t2=e.catch(14),e.abrupt("return",{result:e.t2,status:b.status});case 25:case"end":return e.stop()}}),e,null,[[14,22]])})))).apply(this,arguments)}},94:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var r=n(121),a=n(36),c=n(21),o=n.n(c),s=n(9),i=n(122),u=n(123),l=n(23),d=n(8),f=n(56),v=n(124),h=n(37),p=n(53),b=n(35),g=n(6),k=function(){function e(){var t=this;Object(i.a)(this,e),this.sockets=void 0,this.timeouts=void 0,this.pingInterval=void 0,this.logging=void 0,this.handleMessage=void 0,this.handleOpen=void 0,this.handleClose=void 0,this.handleReconnect=void 0,this.socketEvents=void 0,this.sagaEffects=[],this._ping=function(e){t.sockets[e].socket.send(g.a),t.timeouts[e]=setTimeout((function(){t.sockets[e].socket.close(4008,"ping_timeout")}),g.d)},this._onPong=function(e){clearTimeout(t.timeouts[e])},this._listen=function(e){var n=t.sockets[e].socket;n.onopen=function(n){t.pingInterval=setInterval((function(){return t._ping(e)}),g.b),t._log(n,e),t.handleOpen(e)},n.onclose=function(n){if(clearInterval(t.pingInterval),console.log(t.sockets),!n.wasClean){var r=t.sockets[e],a=r.token,c=r.uri;setTimeout((function(){return t.connectToSocket(e,a,c)}),1e4)}t.handleClose(e,n.wasClean),t._log(n,e)},n.onmessage=function(n){n.data===g.c?t._onPong(e):(t.handleMessage(e,JSON.parse(n.data)),t._log(n,e))}},this._log=function(e,n){t.logging&&console.log({event:e,state:t.getState(n),socketObj:t.sockets})},this.getState=function(e){return g.n[t.sockets[e].socket.readyState]},this.connectToSocket=function(e,n,r){if(!t.sockets[e]||g.n[t.sockets[e].socket.readyState]!==g.j){var a=new WebSocket("".concat(p.b).concat(r,"?token=").concat(n));t.sockets[e]={token:n,uri:r,socket:a},t._listen(e)}},this.disconnectFromSocket=function(e){console.log(t.sockets),t.sockets[e].socket.close()},this.onOpen=function(e){t.handleOpen=e},this.onReconnect=function(e){t.handleReconnect=e},this.onMessage=function(e){t.handleMessage=e},this.onClose=function(e){t.handleClose=e},this.sockets={},this.timeouts={},this.pingInterval=null,this.logging=!0,this.handleMessage=function(e){return console.log(e)},this.handleOpen=function(e){return console.log(e)},this.handleClose=function(e){return console.log(e)},this.handleReconnect=function(e){return console.log(e)},this.socketEvents={}}return Object(u.a)(e,[{key:"createModule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.initialState,r=t.single;n||(n=r?{item:{}}:{items:[]},n=Object(s.a)(Object(s.a)({},n),{},{waiting:!1})),this.socketEvents[e]={reducer:Object(v.reducerWithInitialState)(n),events:{}}}},{key:"createLocalEvent",value:function(e,t,n){var r=Object(f.actionCreatorFactory)(e)(t);return this.socketEvents[e].reducer.case(r,(function(e,t){return Object(h.a)(e,(function(e){n(e,t)}))})),r}},{key:"createApi",value:function(e,t,n){var r=Object(f.actionCreatorFactory)(e).async(t);this.sagaEffects.push(Object(l.d)(r.started,o.a.mark((function t(a){var c,i,u,d;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(l.c)((function(e){return e.auth.item.token}));case 3:return c=t.sent,t.next=6,Object(l.c)((function(e){var t,n;return null===(t=e.session.item)||void 0===t||null===(n=t.session)||void 0===n?void 0:n.id}));case 6:return i=t.sent,t.next=9,Object(l.a)((function(){return Object(b.apiCaller)(Object(s.a)(Object(s.a)({endpoint:e},n),{},{data:a.payload,token:c,session_id:i}))}));case 9:if(u=t.sent,d=u.result,"2"===u.status.toString()[0]){t.next=17;break}return console.log(d),t.next=16,Object(l.b)(r.failed({params:a.payload,error:d}));case 16:return t.abrupt("return",t.sent);case 17:return t.next=19,Object(l.b)(r.done({params:a.payload,result:d}));case 19:t.next=26;break;case 21:return t.prev=21,t.t0=t.catch(0),console.log(t.t0),t.next=26,Object(l.b)(r.failed({params:a.payload,error:t.t0}));case 26:case"end":return t.stop()}}),t,null,[[0,21]])}))));var a=this.socketEvents[e].reducer;return a.case(r.started,(function(e,t){return Object(h.a)(e,(function(e){e.waiting=!0,e.error=void 0,n.startReducer&&n.startReducer(e,t)}))})),a.case(r.failed,(function(e,t){var r=t.params,a=t.error;return Object(h.a)(e,(function(e){e.waiting=!1,e.error=a,n.failReducer&&n.failReducer(e,a,r)}))})),a.case(r.done,(function(e,t){var r=t.params,a=t.result;return Object(h.a)(e,(function(e){e.waiting=!1,n.successReducer(e,a,r)}))})),function(e){return r.started(e)}}},{key:"createSocketListener",value:function(e,t,n){var r=Object(f.actionCreatorFactory)(e)(t),a=this.socketEvents[e].reducer;this.socketEvents[e].events[t]=r,a.case(r,(function(e,t){return Object(h.a)(e,(function(e){n(e,t)}))}))}},{key:"events",get:function(){return this.socketEvents}},{key:"reducer",get:function(){var e={};return Object.entries(this.socketEvents).forEach((function(t){var n=Object(a.a)(t,2),r=n[0],c=n[1];e[r]=c.reducer})),Object(d.combineReducers)(e)}},{key:"saga",get:function(){var e=this;return o.a.mark((function t(){var n,a,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Object(r.a)(e.sagaEffects),t.prev=1,n.s();case 3:if((a=n.n()).done){t.next=9;break}return c=a.value,t.next=7,c;case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])}))}}]),e}()},95:function(e,t,n){"use strict"},96:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(36),a=n(6);function c(e){return function(t){return function(n){return function(c){var o,s,i;if(c.meta!==a.f)return n(c);switch(o=n(c),c.type){case a.g:e.onOpen((function(e){t.dispatch({type:a.h,meta:a.f,socketDesc:e})})),e.onClose((function(e,n){console.log("closing ",e,n),t.dispatch({type:a.e,meta:a.f,socketDesc:e,wasClean:n})})),e.onMessage((function(e,n){t.dispatch({type:a.k,payload:n,meta:a.f,socketDesc:e})})),e.onReconnect((function(e){t.dispatch({type:a.l,meta:a.f,socketDesc:e})})),e.connectToSocket(c.socketDesc,c.token,c.uri);break;case a.i:console.log("disconecting "),e.disconnectFromSocket(c.socketDesc);break;case a.k:var u=c.payload.type.split("."),l=Object(r.a)(u,2);s=l[0],i=l[1],e.events.hasOwnProperty(s)&&e.events[s].events.hasOwnProperty(i)?t.dispatch(e.events[s].events[i](c.payload.data)):console.warn({module:s,event:i},"does not exist");break;case a.l:t.dispatch({type:a.m,meta:a.f,socketDesc:c.socketDesc})}return o}}}}},97:function(e,t){},98:function(e,t){}},[[137,1,2]]]);
//# sourceMappingURL=main.9fb4e0e7.chunk.js.map